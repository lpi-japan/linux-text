# viエディタ
Linuxの設定をするためにしばしば利用されるvi(vim)を操作しながら、エディタの基本的な機能を学んでみましょう。

本章では、viの機能のうち、ファイルの開閉やテキストの検索や置換、ページ移動や編集方法など基礎的な操作を解説します。

本章の内容
- viはモーダル型エディタ
- viの基本的な使用方法
- 入力モードへの切り替え
- 編集モードでのカーソルの移動
- 入力モードでのカーソル移動
- 様々な編集操作
- 検索


## viはモーダル型エディタ
viはモーダル型のエディタです。モーダルとは「モードがある」という意味です。Windowsなどで使われている、モードがないモードレス型のエディタと操作方法が異なります。

viを起動すると、最初は編集モードになっています。行や文字の削除、カット、コピー、ペーストなどの編集操作が行えるモードになっています。

入力モードに切り替えると、モードレス型のエディタのように文字の入力や削除が行えます。

### viとvimの関係
viは、様々なUNIXにインストールされているため、どのような環境においても設定ファイルなどの編集が行えるように使い方を覚えておくべき基本的なエディタです。

現在ではオリジナルのviではなく、新たにクローンとして開発されたvim（Vi IMproved・改善されたvi）が使用されています。vimでは、より使いやすくなるよう様々な機能が強化改善されています。

## viの基本的な使用方法
viはモーダル型エディタのため、入力モードや編集モードへの切り替え、ファイルの保存や終了方法がモードレス型エディタと異なります。

viの起動からファイルの保存、viの終了までの基本的な流れを確認しましょう。

### viを起動する
viでファイルを開くにはviコマンドの後に編集したいファイルを指定します。

```
書式
vi [ファイル]
```

指定したファイルが存在しない場合、保存時に新しいファイルが作成されます。ファイルを指定しなかった場合、保存時にファイル名を指定する必要があります。

新しくtest.txtを作成するように指定して、viを起動します。

```
$ vi test.txt
```

★スクショ入れる

### 入力モードに切り替える
viを起動した直後は編集モードになっています。入力モードに切り替えて、文字を入力してみます。

一番簡単な入力モードへの切り替えは、「i」（Insert）を入力します。画面左下に「-- 挿入 --」と表示されて、入力モードに切り替わります。

何か適当な文字を入力してみます。BackSpaceキーやDeleteキーで文字を消すこともできます。

★スクショ入れる

vimでは、入力モードの状態でもカーソルキーでカーソルを移動できます。

### 編集モードに切り替える
入力モードから編集モードに切り替えるには、ESCキーを入力します。

画面左下の「-- 挿入 --」の表示が消えて、編集モードに切り替わります。

viを使っていると、現在の状態がわからなくなってしまうことがあります。そのような時には、ひとまずESCキーを入力して編集モードに切り替えるとよいでしょう。

### ファイルを保存する
ファイルを保存するには、編集モードで保存のコマンドを実行します。

コマンドを実行するには「:」を入力します。画面左下に「:」が表示されて、コマンドを受け付ける状態になります。ファイルを保存するには「w」（Write）を入力します。

新しく作成したファイルの場合、画面左下に「"test.txt" [新] xL, xB 書込み」と表示されて、新しくファイルが作成されたことが分かります。

★スクショ入れる

### viを終了する
viを終了するには、編集モードの状態で終了のコマンドを入力します。

終了は「:q」（Quit）とコマンドを入力します。正常に終了すると、コマンドラインに戻ります。

編集中のファイルが未保存の場合、警告が表示されて終了できません。未保存の状態から終了するには、次の2つの方法のいずれかを行う必要があります。

### ファイルの保存と終了を同時に行う
ファイルの保存とviの終了を同時に行うには「:wq」と入力します。

### ファイルを保存せずに終了する
間違えて修正してしまった場合など、保存せずに終了したい場合には「:q!」と入力します。編集内容は破棄されて、コマンドラインに戻ります。

### ZZで保存終了する
:wqと似た動作をするものとしてZZがあります。

:wqは変更が無い場合でもファイルを保存して終了するので、タイムスタンプが:wq実行時点のものに変更されます。

一方、ZZは変更がある場合には保存し、変更が無い場合には保存せずviを終了するのでタイムスタンプが変更されません。

プログラムのソースコードファイルの場合、タイムスタンプで変更の有無を判断するので、:wqだと不都合が起きる場合がありますので、:wqとZZを使い分けるようにするとよいでしょう。

## 入力モードへの切り替え
編集モードから入力モードへの切り替えは、「i」以外にもいくつかあります。それぞれ入力モードに入った際のカーソル位置などが異なるので、状況に応じて使い分けるとよいでしょう。

以下の解説は、それぞれ自身で試してみてください。

### 行の先頭に入力
「i」はカーソルの位置から入力になりますが、「I」（Shift+i）を入力すると、カーソルがどの位置にあってもカーソルが行頭まで移動して入力モードになります。

### カーソルの後ろ、行末から入力
「i」はカーソルの位置から入力になりますが、行末にカーソルがある時に末尾以降への文字入力が行えません。正確には、入力モードに切り替えた後、右カーソルで1文字分カーソルを移動させる必要があります。

「a」（Append）を入力すると、カーソルが1文字分右に移動した後に入力モードになります。また「A」（Shift+a）を入力すると、カーソルがどの位置にあってもカーソルが行末まで移動して入力モードになります。

### カーソルの前後の行から入力
カーソルの前の行に入力したり、後ろの行に入力できます。

「o」を入力すると、カーソルの後ろの行に空行が挿入されて入力モードになります。また「O」（Shift+o）を入力すると、カーソル位置に空行が挿入されて入力モードになります。

## 編集モードでのカーソルの移動
入力モードでカーソルキーを使ってカーソルを移動させることもできますが、本来のviは編集モードでカーソルを移動させます。また、各種編集作業を行う際にもカーソル移動が必要となるので、編集モードでのカーソル移動について解説します。

### 1文字単位の移動
編集モードでのカーソル移動は、vimではカーソルキーでも行えますが、hjklキーでも行えます。

カーソルの移動
| コマンド | カーソルの動き
| - | -
| h | ←左
| j | ↓下
| k | ↑上
| l | →右

キーボードの並びでhが左端、lが右端なので、そのまま左右になります。

### 行頭、行末への移動
「0」（ゼロ）を入力すると、現在の行の行頭に移動します。

「$」を入力すると、現在のカレント行の行末に移動します。

### 先頭行、最終行への移動
「gg」を入力すると文書の先頭、1行目に移動します。

「G」（Shift+g）を入力すると文書の最後尾、最終行に移動します。

## 入力モードでのカーソル移動
入力モードでも、カーソルキー以外でカーソルを移動させることができます。

### ページ単位でのカーソル移動
「Ctrl+f」（Forward）で次のページに移動します。

「Ctrl+b」（Backward）で前のページに移動します。

### 行番号を指定した移動
「:」の後に数値を入力すると、指定された番号の行に移動します。

## 様々な編集操作
編集モードでは文字の削除の他、「カット＆ペースト」や「コピー＆ペースト」、アンドゥなどが行えます。

編集モードで使える基本的なコマンドです。

カット・アンド・ペーストで使うコマンド
| コマンド | 内容
| - | -
| x | 1文字削除（バッファに入る）
| dd | 1行削除（バッファに入る）
| yy | 1行コピー（ヤンク）
| p | カーソルの文字の次、または後ろの行にペースト
| P | カーソルの文字の前、または前の行にペースト
| r | カーソル位置の文字を書き換える
| cw | カーソル位置からの単語を書き換える
| u | カット、ペーストを一回取り消し（アンドゥ）

### 文字のカット＆ペースト
「x」で文字を削除すると、その文字はバッファに格納されます。

「p」を入力すると、バッファに格納されている文字がカーソルの後ろにペーストされます。「P」（Shift+p）を入力すると、カーソルの位置にペーストされます。

### 行のカット＆ペースト
「dd」で行を削除すると、その行はバッファに格納されます。

「p」を入力すると、バッファに格納されている行がカーソルの後ろの行にペーストされます。「P」（Shift+p）を入力すると、カーソルの前の行にペーストされます。

### 行のコピー＆ペースト
「yy」で行をバッファに格納できます。これを「ヤンク」（Yank・引っ張るの意）と呼びます。

「p」を入力すると、バッファに格納されている行がカーソルの後ろの行にペーストされます。「P」（Shift+p）を入力すると、カーソルの前の行にペーストされます。

### 1文字の書き換え
「r」を入力すると、カーソル位置の1文字を書き換えれます。表示は変わりませんが、書き換えたい文字を入力すると文字が書き換わります。

### 単語の書き換え
「cw」を入力すると、単語の書き換えができます。カーソル位置から単語の終わりまでが消去され、文字入力モードに切り替わります。書き換えたい文字を入力して、必要に応じてESCキーを押して編集モードに戻ります。

単語の終わりがどこまでなのかは、英語等の表記の場合は空白で判定されます。日本語の場合には単語終わりの判定が難しく1文字だけ、あるいは漢字だけなどの書き換えになってしまいます。

### アンドゥによる編集作業の取り消し
カット＆ペーストなどの編集作業は、vimではアンドゥで取り消すことができます。

「u」（Undo）を入力すると、直前の編集作業が取り消されます。入力し続けると、一番最初の無編集の状態まで戻すことができます。

## 検索
編集モードで/コマンドを使うと、目的の文字列を検索してカーソルを移動します。

検索に関するコマンド
| コマンド | 内容	
| - | -
| /検索文字列 | 文字列の検索
| n | 下方向へ再検索
| N | 上方向へ再検索

### 文字列の検索
編集モードで「/」を入力すると、画面左下に/が表示されます。検索したい文字列を続けて入力してEnterキーを入力すると、文字列が検索されてカーソルが移動します。

同じ文字列が複数ある場合、「n」を入力すると次の文字列が検索されてカーソルが移動します。「N」（Shift+n）を入力すると前の文字列が検索されてカーソルが移動します。

最終行まで到達すると、「下まで検索したので上に戻ります」と表示されて、最初に検索された文字列にカーソルが移動します。

文字列を検索すると検索した文字列がハイライト表示されます。このハイライト表示は次の文字列を検索するまでハイライト表示が残ります。ハイライトを消すには:nohlsearchコマンドを実行してください。

\pagebreak


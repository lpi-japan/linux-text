# 基本的なコマンド
Linuxを操作する基本は、コマンドを入力して操作する方法です。この章では、ファイルとディレクトリの基本的な考え方に始まり、ファイルに関するコマンドやLinuxを利用する上で必要な基本的なコマンドを学習します。

## ファイルとディレクトリの参照
Linuxは、コマンドやプログラム、設定ファイルなど様々なファイルでシステムを構成しています。また、それらのファイルを目的別に分類するため、様々なディレクトリに分けて格納しています。これらのファイル、ディレクトリを参照するのは、Linux操作の基本です。ファイルやディレクトリの一覧を取得するにはls(LiSt)コマンドを使用します。

### ファイルとディレクトリ
コンピュータの基本的な作業は、情報（＝データ）を処理することにあります。データをコンピュータ上に保存しておく方法として、ファイルという形式が用いられます。文書を作成したら文書ファイルを保存しますし、デジカメで写真を撮ったら、画像ファイルをパソコンに保存する、といった具合です。

ファイルの数が増えると、内容や用途といった目的別に分ける必要が出てきます。このときに必要なものが、ディレクトリという考え方です。ディレクトリは、複数のファイルをまとめておくことができます。また、ディレクトリの中にディレクトリを作成することも可能です。

![ユーザー名設定の画面](image/Ch3/linuxtext2-img03.png){width=70%}

### lsコマンドによるファイルやディレクトリの参照
lsコマンドでは、引数としてファイルやディレクトリを指定して情報を取得することができます。ディレクトリを指定した場合、そのディレクトリの中にあるファイルやディレクトリの一覧を取得することができます。引数を省略した場合、カレントディレクトリの情報を取得します。

書式
ls [オプション] [ファイル]

オプション
-a
.で始まる隠しファイル等もすべて(All)出力します。

-l
詳細(Long)形式で出力します。

現在作業しているディレクトリ（カレントディレクトリ）内にあるファイルやディレクトリの一覧を表示してみましょう。いくつかのディレクトリがあることがわかります。

$ ls
ダウンロード デスクトップ ビデオ 画像
テンプレート ドキュメント 音楽   公開

lsコマンドの後にファイルやディレクトリを指定した場合、指定したディレクトリ内にあるファイルやディレクトリを一覧表示することができます。以下の実行例では/usrディレクトリ内を参照しています。

$ ls /usr
bin  games  include  lib  lib64  libexec  local  sbin  share  src  tmp

### 書式
書式とは、そのコマンドが用いられる形式を示しています。コマンド実行時に指定できるオプションや引数などの要素を、どのように指定するかを示します。

#### オプション
コマンドはオプションを指定することで、その動作を変えることができます。

オプションには、-（ハイフン）に1文字だけ指定する形式、ハイフンが不要な形式、ハイフンが2つに単語で指定する形式があります。

#### 引数
コマンドの実行対象となるファイルやディレクトリなどを引数（ひきすう）として指定します。引数を省略した場合、デフォルトの値が適用されます。引数を必要としないコマンドもあります。

### lsコマンドでワイルドカードを使った絞り込み
引数にワイルドカードを使うと、lsコマンドで表示するファイルやディレクトリの絞り込みが行えます。ワイルドカードには、「*」（アスタリスク）と「?」の2種類があります。

まずは/etcディレクトリ上にあるファイルやディレクトリの一覧を表示してみましょう。

$ ls /etc
DIR_COLORS               gnupg                     pm
DIR_COLORS.lightbgcolor  groff                     pnm2ppa.conf
（略）

/etcディレクトリには、多くのファイルやディレクトリが存在していることがわかります。ワイルドカードを使って絞り込んでリスト表示してみましょう。

/etcディレクトリ内の.confファイルを絞り込んで表示するには、以下のように指定することができます。

$ ls /etc/*.conf
anthy-unicode.conf  kdump.conf      nsswitch.conf   sysctl.conf
appstream.conf      krb5.conf       pbm2ppa.conf    updatedb.conf
（略）

「*」は任意の文字列を示しており、*で指定した位置にいくつ文字が入っても検索結果として出力されます。「*.conf」と指定することで、.confで終わるファイルがリスト表示されました。

ファイル名の文字数がわかっている場合は「?」を使って絞り込むこともできます。?は一個につき何らかの一文字を示します。ファイル名部分が3文字のconfが検索結果として出力されます。

$ ls /etc/???.conf
yum.conf

### ls -lコマンドの実行
-lオプションを付けてlsコマンドを実行した場合、詳細な形式で出力されます。

$ ls -l
合計 0
drwxr-xr-x. 2 linuc linuc 6  8月 10 15:09 ダウンロード
drwxr-xr-x. 2 linuc linuc 6  8月 10 15:09 テンプレート
（略）

### ドットファイルの表示
Linuxでは、ファイル名が「.」（ドット）で始まるドットファイルという形式があります。ドットファイルは通常のlsコマンドでは表示されない隠しファイルとなっています。ドットファイルは様々なアプリケーションの設定などを補完するために利用されています。ドットファイルを表示するには、-aオプションを付けてlsコマンドを実行します。以下の例では詳細形式の-lオプションと一緒に実行しています。

$ ls -la
合計 24
drwx------. 14 linuc linuc 4096  8月 10 15:09 .
drwxr-xr-x.  3 root  root    19  8月 10 15:05 ..
-rw-r--r--.  1 linuc linuc   18  4月 30 23:14 .bash_logout
-rw-r--r--.  1 linuc linuc  141  4月 30 23:14 .bash_profile
（略）

### オプションの同時指定と順序
lオプションは、まとめてもまとめなくても同じ結果になります。さらに、順不同なので入れ替えても同じ結果になります。ただし、コマンドによっては順序と文法が細かく決まっている場合があるため、コマンドを実行する前にマニュアルやヘルプを参照してオプションの指定方法を確認してください。
コマンドオプションはハイフンを使って指定することが一般的ですが、コマンドによってはハイフンを必要としないコマンドもあるため注意が必要です。

$ ls -la
$ ls -al
$ ls -l -a
$ ls -a -l

## ファイルの内容を表示
ファイルの内容を表示するコマンドについて説明します。単純にファイルの内容を表示するcatコマンドと、ページ単位で表示するlessコマンドがあります。

### ファイルの内容を表示(catコマンド)
cat（conCATenate）コマンドは、本来は引数に指定された複数のファイルを連結（concatenate）して出力するコマンドですが、ファイルを1つだけ指定して内容を表示するコマンドとして使用されます。

書式
cat ファイル名
ファイルの内容を表示することができます。

オプション
-n
行番号を付加して表示します。

ホームディレクトリ内のファイル.bashrcを確認してみましょう。

$ cat ~/.bashrc
# .bashrc

# Source global definitions
if [ -f /etc/bashrc ]; then
	. /etc/bashrc
fi
（略）

-nオプションを付けることで、行番号を付けて表示できます。

$ cat -n ~/.bashrc
     1	# .bashrc
     2
     3	# Source global definitions
     4	if [ -f /etc/bashrc ]; then
     5		. /etc/bashrc
     6	fi
（略）

### ページャを使った表示
catコマンドを使ってファイルの内容を表示するとき、行数がたくさんあると表示が流れてしまいます。コマンドラインを実行する端末は多くの場合表示行数は25行に設定されているため、25行以上の行は流れてしまってスクロールさせないと確認できません。

たくさんの行があっても、画面制御を行なってスクロールを途中で止めてくれる機能のことをページングといい、それを実現するコマンドをページャといいます。

代表的なページャとしてはlessコマンドがあげられます。

lessコマンドの操作
| キー | 動作
|-|-
| スペース | 次のページに進む
| b | 前の一画面に戻る
| f | 次の一画面に進む
| ↑ | 前の行に進む
| ↓| 	次の行に進む
| /単語 | 単語を検索します。nキーで検索結果をジャンプします
| q | ページャコマンドを終了(quit)します。

ページャを使って、たくさんの行があるファイルの表示を行います。さまざまなキーを入力して動作を確認した後、qを入力して終了させてください。

$ less /etc/services

## 空のファイルを作成する
touchコマンドを実行すると、ファイルサイズが0バイトの空のファイルを作成できます。

touchコマンドは本来、ファイルの更新日を変更するコマンドですが、存在しないファイルを引数に指定して実行すると空のファイルが作成されます。今後の実習では、ファイル操作のテスト用ファイルを作成するのに私用します。

書式
touch ファイル名


$ touch test
$ ls -l test
-rw-r--r--. 1 linuc linuc 0  8月 18 10:41 test

testファイルが作成されました。ファイルの中身は空なので、サイズが0バイトになっています。

## ディレクトリの操作
ディレクトリの操作に使われるコマンドとして、pwd、cd、mkdir、rmdirについて説明します。 

### カレントディレクトリの表示(pwdコマンド)
pwd(Print Working Directory)コマンドは、現在作業を行っているカレントディレクトリを表示します。

書式
pwd

カレントディレクトリが/home/linucであることがわかります。「/」はディレクトリの区切りを示す記号です。

$ pwd
/home/linuc


### ディレクトリの変更(cd)
cd(Change Directory)コマンドを実行すると、現在いるディレクトリを変更することができます。引数として移動先のディレクトリを指定します。ディレクトリを指定しない場合はホームディレクトリに移動します。

書式
cd [ディレクトリ]

pwdで現在いる場所を確認して、cdコマンドでディレクトリの移動を行ないます。

$ pwd
/home/linuc
$ cd /usr
$ pwd
/usr
$ cd
$ pwd
/home/linuc

### ディレクトリの作成(mkdir)
mkdirコマンドを実行すると、ディレクトリを作成できます。引数として作成するディレクトリ名を指定します。

書式
mkdir ディレクトリ名

オプション
-p
指定されたディレクトリの上位ディレクトリも作成する

ディレクトリdir1を作成し、dir1の下にディレクトリdir2を作成します。

$ mkdir dir1
$ mkdir dir1/dir2
dir1:
dir2

dir1/dir2:

mkdirコマンドを2つに分けて実行しました。これは、ディレクトリを作るときはその上位層ができていないと作成できない、という制約があるためです。
lsコマンドに-Rオプションをつけて実行すると、指定したディレクトリ以下のすべてを表示することができます。

mkdirコマンドに-pオプションを付けて実行すると次のように一度に実行できます。

$ mkdir dir3/dir4
mkdir: ディレクトリ `dir3/dir4' を作成できません: そのようなファイルやディレクトリはありません
$ mkdir -p dir3/dir4
dir3:
dir4

dir3/dir4:

### ディレクトリの削除(rmdir)
ディレクトリを削除するには、rmdirコマンドを使用します。

書式
rmdir ディレクトリ名

オプション
-p
指定した階層までのディレクトリを一括で削除します。

rmdirの特徴は、「中が空であるときのみ」ディレクトリを削除できることです。ディレクトリの中にファイルやディレクトリが存在していると、ディレクトリは削除できません。

$ ls
dir1  ダウンロード  デスクトップ  ビデオ  画像
dir3  テンプレート  ドキュメント  音楽    公開
$ rmdir dir1
rmdir: 'dir1' を削除できません: ディレクトリは空ではありません
$ rmdir -p dir1/dir2
$ ls
ダウンロード  デスクトップ  ビデオ  画像
dir3  テンプレート  ドキュメント  音楽    公開

ディレクトリ内にファイルが存在する場合、rmdirコマンドではそのディレクトリは削除できません。ファイルも含めてディレクトリを削除するには以下のようにrm -rコマンドを用いて行なうことができます。

touchコマンドを使うと、引数に指定したファイル名でサイズ0のファイルを作成できます。

$ touch dir3/dir4/test
$  ls -lR dir3
dir3:
合計 0
drwxr-xr-x. 2 linuc linuc 18  8月 11 12:21 dir4

dir3/dir4:
合計 0
-rw-r--r--. 1 linuc linuc 0  8月 11 12:21 test
$ rmdir -p dir3/dir4
rmdir: 'dir3/dir4' を削除できません: ディレクトリは空ではありません
$ rm -r dir3
$ ls
テンプレート  ドキュメント  音楽  公開
ダウンロード  デスクトップ  ビデオ        画像

## 特別なディレクトリ
Linuxでは、ディレクトリの中で特別なディレクトリや、それを表す記号があります。以下がその代表的なものです。

### カレントディレクトリ(.)
現在いるディレクトリのことです。ファイルやディレクトリ操作では「ドット」を使って表わします。

### 親ディレクトリ(..)
1階層上のディレクトリのことです。カレントディレクトリが/home/linucの場合、/homeが親ディレクトリにあたります。

### ホームディレクトリ(~)
ユーザの作業開始位置となるディレクトリです。ログイン直後のユーザは、必ずホームディレクトリにいます。ユーザごとに異なるホームディレクトリを使うので、それぞれのユーザにとってホームディレクトリは異なります。ファイルやディレクトリ操作では「~」（チルダ）を使って表わします。

### ルートディレクトリ(/)
ディレクトリ階層の、最上位階層を示します。ファイルやディレクトリ操作では「/」（ルート）を使って表わします。

### 絶対(パス)指定と相対(パス)指定
カレントディレクトリが/home/linucであるとします。このとき、/usr/bin/xxxのファイルを指定するには、次の2通りが存在します。

 1. /usr/bin/xxx
 1. ../bin/xxx

1.は、最上位のディレクトリ(/)からディレクトリ・ファイル名を指定しています。2.は、「自分が現在いる位置からみて」ディレクトリ・ファイル名を指定しています。1.の方法を絶対(パス)指定といい、2.の方法を相対(パス)指定といいます。
絶対(パス)指定は、どのディレクトリにいてもパスを指定できます。逆に、相対(パス)指定は、現在のディレクトリが変わると利用できない、という特徴があります。また、絶対(パス)指定は、常に/から指定するので非常に記述が長くなることがあります。相対(パス)指定は、現在の位置から見て非常に近いディレクトリのときは、指定の記述が短くて済む、という特徴があります。


それでは早速、ディレクトリからディレクトリへ、コマンドを実行して移動してみましょう。

$ cd ~
$ pwd
/home/linuc
$ cd ..
$ pwd
/home
$ cd /usr
$ pwd
/usr
$ cd ~	
$ pwd
/home/linuc
$ cd ../../
$ pwd
/

## ファイルのコピー(cpコマンド)
cp(CoPy)コマンドを実行すると、ファイルをコピーすることができます。引数に指定するコピー元やコピー先、オプションによって様々な形でコピーが行えます。

書式
cp [オプション] コピー元 コピー先

オプション
-r
ディレクトリをコピーします。-rオプションを付けて実行すると、ディレクトリの中にある全てのファイルおよびディレクトリをコピーできます。

### ファイルをディレクトリにコピー
コピー先にディレクトリを指定すると、ディレクトリ内にファイルのコピーが作成されます。ファイル名は、コピー元のファイル名のままコピーされます。

$ pwd
/home/linuc
$ mkdir work
$ cd work
$ pwd
/home/linuc/work
$ ls
$ cp /etc/hosts /home/linuc/work
$ ls -l
合計 4
-rw-r--r--. 1 linuc linuc 158  8月 11 12:47 hosts
$ ls -l /etc/hosts
-rw-r--r--. 1 root root 158  6月 23  2020 /etc/hosts

カレントディレクトリにコピーする場合には、コピー先に「.」を指定します。

$ cp /etc/services .
$ ls -l
合計 684
-rw-r--r--. 1 linuc linuc    158  8月 11 12:47 hosts
-rw-r--r--. 1 linuc linuc 692252  8月 11 12:48 services
$ ls -l /etc/services
-rw-r--r--. 1 root root 692252  6月 23  2020 /etc/services

### ファイルを別のファイル名としてコピー
コピー先に存在しないファイル名を指定すると、指定したファイル名でファイルのコピーが作成されます。

$ cp /etc/services copytest
$ ls -l
合計 1364
-rw-r--r--. 1 linuc linuc 692252  8月 11 12:49 copytest
-rw-r--r--. 1 linuc linuc    158  8月 11 12:47 hosts
-rw-r--r--. 1 linuc linuc 692252  8月 11 12:48 services

### ファイルを上書きでコピー
コピー先に存在するファイル名を指定すると、ファイルは上書きコピーされます。

$ cp /etc/hosts copytest
$ ls -l
合計 688
-rw-r--r--. 1 linuc linuc    158  8月 11 12:50 copytest
-rw-r--r--. 1 linuc linuc    158  8月 11 12:47 hosts
-rw-r--r--. 1 linuc linuc 692252  8月 11 12:48 services

### ディレクトリをコピー
コピー元にディレクトリを指定すると、ディレクトリ内のファイルおよびディレクトリをまとめてコピーできます。コピー先にはディレクトリを指定します。

$ mkdir moto
$ touch moto/test
$ ls -R moto/
moto/:
test
$ ls -R moto
moto:
test
$ cp -r moto saki
$ ls -R saki
saki:
test


## ファイルの移動(mv)
mv(MoVe)コマンドを実行すると、ファイルを移動できます。また、mvコマンドを使ってファイル名の変更も行えます。

書式
mv 移動元 移動先

### ファイルを別のディレクトリに移動
移動元がファイルで、移動先がディレクトリの場合、移動元のファイルを移動先のディレクトリ内に移動します。

$ touch moto/mvtest
$ ls -R moto/
moto/:
mvtest  test
$ mv moto/mvtest saki
$ ls -R moto/
moto/:
test
$ ls -R saki
saki:
mvtest  test

### ディレクトリを別のディレクトリに移動

移動元がディレクトリで、移動先がディレクトリの場合、移動元のディレクトリは移動先のディレクトリ内に移動します。

$ ls -R saki/
saki/:
moto  mvtest  test

saki/moto:
test

### ファイル名の変更
移動元がファイルで、移動先が存在しないファイルの場合、移動元のファイル名が移動先に指定したファイル名に変更されます。

$ ls
copytest  hosts  saki  services
$ mv copytest renametest
$ ls
hosts  renametest  saki  services

### ディレクトリ名の変更
移動元がディレクトリで、移動先が存在しないディレクトリの場合、移動元のディレクトリが移動先に指定したディレクトリ名に変更されます。

$ mv saki renamedir
$ ls
hosts  renamedir  renametest  services

## ファイルの削除(rm)
rm(ReMove)コマンドを実行すると、ファイルを削除できます。

書式
rm ファイル名

オプション
-f
強制的に削除を実行します。ファイルによっては削除に確認が求められますが、確認を行わず強制的に削除を行います。

-i
対象ファイルを本当に削除してよいか、確認を求めます。誤って削除することを防ぐために利用されます。

-r
ディレクトリを削除します。ディレクトリの中のファイルやディレクトリも削除します。

$ pwd
/home/linuc/work
$ ls
hosts  renamedir  renametest  services
$ rm rename
renamedir/  renametest
$ rm rename
renamedir/  renametest
$ rm renametest
$ ls
hosts  renamedir  services
$ rm renamedir
rm: 'renamedir' を削除できません: ディレクトリです
$ rm -r renamedir/
$ ls
hosts  services

### 削除したファイルは復元できない
Linuxでは、一度削除したファイルを復活させることはできません。-fオプションで確認無しで削除する場合や、-rオプションでディレクトリごとまとめて削除する場合には注意が必要です。

## ファイルの検索（find）
ファイルがどこのディレクトリに存在するか、findコマンドにて検索できます。

書式
find ディレクトリ -name ファイル名

/etc配下にあるhostsという名前のファイルを検索してみましょう。セキュリティなどの関係で参照が許されていないディレクトリ内は検索が行えませんため、エラーが出ます。

$ find /etc/ -name hosts
find: ‘/etc/lvm/devices’: 許可がありません
（略）
/etc/hosts
（略）

## コマンドのパスを表示（whichコマンド）
コマンドの実体はプログラムです。プログラムもファイルの一種であり、/binや/sbinといったプログラム用のディレクトリに配置されています。

基本的なコマンドを実行するとき、その実体であるプログラムがどのディレクトリに配置されているかを意識する必要はありません。これは、PATHという環境変数にプログラムが配置されているディレクトリが設定されているからです。

whichコマンドを実行すると、引数に指定したコマンドがPATH環境変数に含まれるディレクトリのうち、どのディレクトリにあるものかを表示できます。

書式
which コマンド名

$ which cat
/usr/bin/cat

### 環境変数PATHの設定確認
環境変数PATHに設定された値を表示するには、echoコマンドを使用します。環境変数名の前に$を付けることで、その環境変数に設定された値を参照できます。

$ echo $PATH
/home/linuc/.local/bin:/home/linuc/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin

## コマンドのヘルプを表示する
コマンドにはヘルプが含まれていることがあります。実行したいコマンドに対して--helpオプションをつけて実行することで、コマンドのヘルプを表示できます。

書式
コマンド --help

$ ls --help
使用法: ls [オプション]... [ファイル]...
List information about the FILEs (the current directory by default).
Sort entries alphabetically if none of -cftuvSUX nor --sort is specified.
（略）

## マニュアルの使い方
Linuxには、便利なオンラインマニュアルが含まれています。ここではその使い方を紹介します。

書式
man [セクション] コマンド名

$ man ls
LS(1)                            User Commands                           LS(1)

NAME
       ls - list directory contents

SYNOPSIS
       ls [OPTION]... [FILE]...

DESCRIPTION
       List  information  about  the FILEs (the current directory by default).
       Sort entries alphabetically if none of -cftuvSUX nor --sort  is  speci‐
       fied.
（略）

- SYNOPSIS（書式）
コマンドの書式です。

- DESCRIPTION（説明）
コマンドなどの説明です。オプションの解説が含まれる場合があります。

- OPTIONS
コマンドのオプションです。

- SEE ALSO（関連事項）
このプログラムに関連しているコマンドなどが記載されています。ここに列挙している内容をmanコマンドで調べることができます。

### マニュアルのセクション
lsのマニュアルの先頭に「LS(1) 」という記述があります。これはlsのマニュアルがセクション1に分類されている、という意味です。マニュアルのセクションとは、マニュアルを種類毎に分類したものです。セクションには番号がついており、以下の表のようになっています。

| 項目 | 内容
|-|-
| 1 | ユーザコマンド
| 2 | システムコール
| 3 | システムライブラリや関数
| 4 | デバイスやデバイスドライバ
| 5 | ファイルの形式
| 6 | ゲームやデモなど
| 7 | その他
| 8 | システム管理系のコマンド
| 9 | カーネルなどの情報

### セクションを指定したマニュアルの表示
同じ名称でも、複数のマニュアルに分かれていることがあります。passwdコマンドはセクション1のユーザコマンドである他、ユーザーのパスワードを保存した設定ファイルでもあるのでセクション5にもマニュアルがあります。

$ man passwd
PASSWD(1)                   General Commands Manual                  PASSWD(1)

名前
       passwd - ユーザパスワードを変更する

書式
       passwd  [-k]  [-l]  [-u  [-f]]  [-d] [-e] [-n mindays] [-x maxdays] [-w
       warndays] [-i inactivedays] [-S] [--stdin] [username]
（略）

セクション5のpasswdのエントリを見るには、セクション番号をオプションとして指定します。

$ man 5 passwd
passwd(5)                     File Formats Manual                    passwd(5)

NAME
       passwd - password file

DESCRIPTION
       The  /etc/passwd file is a text file that describes user login accounts
       for the system.  It should have read permission allowed for  all  users
       (many  utilities,  like ls(1) use it to map user IDs to usernames), but
       write access only for the superuser.
（略）


